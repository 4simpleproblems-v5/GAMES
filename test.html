<!DOCTYPE html>
<html lang="en">
<head>
    <title>4SP - Game Hub</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <link rel="icon" type="image/x-icon" href="img/favicon.ico" id="faviconLink" />

    <!-- Fonts and Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Geist:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 
      NOTE: The original file loaded ../navigation.js. 
      Assuming index.html is in the root, this might need to be ./navigation.js 
      I am keeping it as-is from your provided file.
    -->
    <script src="../navigation.js"></script>

    <!-- Tailwind CSS Configuration -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'deep-black': '#070707',
                        'card-dark': '#111111',
                        'accent-indigo': '#4f46e5', // Unified accent color
                        'brand-border': '#252525',
                        'strongdog-orange': '#FFA500',
                        'gn-math': '#FB2651',
                        'other-grey': '#AAAAAA', // New category color (Light Grey)
                    },
                    fontFamily: {
                        sans: ['Geist', 'sans-serif'],
                    },
                    borderRadius: {
                        'md': '0.375rem',
                        'lg': '0.5rem',
                        'xl': '1rem',
                    },
                    aspectRatio: {
                        '3/2': '3 / 2',
                        '16/9': '16 / 9', // Added 16/9 aspect ratio for special cards
                    },
                }
            }
        }
    </script>
    
    <!-- Custom Styles -->
    <style>
        /* Base styles */
        body {
            font-family: 'Geist', 'sans-serif';
            font-weight: 300;
            background-color: #070707;
            padding-bottom: 100px; /* Space for the fixed search bar */
        }
        
        h1, h2, h3, .font-bold, .font-semibold, strong {
            font-weight: 400 !important;
        }
        
        .zone-item {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .zone-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.2);
        }

        /* --- Play Button Hover CSS --- */
        .play-btn .fa-solid-play { display: inline-block; }
        .play-btn .fa-regular-play { display: none; }
        .play-btn:hover .fa-solid-play { display: none; }
        .play-btn:hover .fa-regular-play { display: inline-block; }

        /* --- Favorite Star Hover CSS --- */
        .favorite-btn .fa-solid-star { display: inline-block; }
        .favorite-btn .fa-regular-star { display: none; }
        .favorite-btn:not(.favorited):hover .fa-solid-star { display: none; }
        .favorite-btn:not(.favorited):hover .fa-regular-star { display: inline-block; color: white; }
        .favorite-btn.favorited .fa-solid-star { display: inline-block; color: #facc15; }
        .favorite-btn.favorited .fa-regular-star { display: none; }
        .favorite-btn.favorited:hover .fa-solid-star { display: none; }
        .favorite-btn.favorited:hover .fa-regular-star { display: inline-block; color: #facc15; }
        
        /* Search Bar Results Styling */
        #searchResults {
            max-height: 400px; /* Limit height */
            overflow-y: auto;
            position: absolute;
            bottom: 100%; /* Position above the fixed bar */
            left: 0;
            right: 0;
            z-index: 50;
        }
        #searchResults a {
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #1a1a1a;
        }
        #searchResults a:hover {
            background-color: #1a1a1a;
        }

        /* Zone Viewer/Game Frame */
        #zoneViewer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            display: none;
            background-color: #070707;
            flex-direction: column;
        }
        #zoneFrame {
            flex-grow: 1;
            width: 100%;
            height: 100%;
            border: none;
        }

    </style>
</head>
<body class="dark text-white">

    <!-- Header and Navigation -->
    <header class="p-6">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-3xl font-bold text-white tracking-tight">4SP Games</h1>
            <button id="categoryCycleBtn" class="sm:hidden p-2 rounded-full bg-card-dark text-gray-300 hover:text-white transition">
                <i class="fa-solid fa-arrow-right-arrow-left"></i>
            </button>
            <nav class="hidden sm:flex space-x-4">
                <a href="../index.html" class="text-gray-400 hover:text-white transition">Home</a>
                <a href="#" class="text-white font-semibold transition">Games</a>
                <a href="../apps.html" class="text-gray-400 hover:text-white transition">Apps</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto p-6 pt-0">
        
        <!-- Category Navigation & Title -->
        <div class="flex justify-between items-center mb-6 border-b border-brand-border pb-3">
            <button id="prevCategoryBtn" class="hidden sm:block p-2 rounded-full bg-card-dark text-gray-300 hover:text-white transition">
                <i class="fa-solid fa-chevron-left"></i>
            </button>

            <!-- Category Display Title -->
            <h2 id="categoryTitle" class="text-4xl font-semibold text-center uppercase tracking-wider mx-4" style="color: #4f46e5;">Featured</h2>
            
            <button id="nextCategoryBtn" class="hidden sm:block p-2 rounded-full bg-card-dark text-gray-300 hover:text-white transition">
                <i class="fa-solid fa-chevron-right"></i>
            </button>
        </div>

        <!-- Games Grid -->
        <!-- Adjusted the grid for better responsiveness and to accommodate full-width cards -->
        <div id="gamesContainer" class="grid grid-cols-12 gap-4">
            <!-- Game cards will be injected here -->
        </div>
        
    </main>

    <!-- Fixed Bottom Bar for Search -->
    <div id="bottom-fixed-bar" class="fixed bottom-0 left-0 right-0 p-4 bg-deep-black border-t border-brand-border z-40">
        <div class="relative container mx-auto">
            <input type="text" id="searchInput" placeholder="Search games..." class="w-full p-3 pl-10 rounded-xl bg-card-dark border border-brand-border text-white focus:outline-none focus:ring-2 focus:ring-accent-indigo transition" />
            <i class="fa-solid fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500"></i>

            <!-- Search Results Dropdown -->
            <div id="searchResults" class="hidden bg-card-dark rounded-xl shadow-2xl border border-brand-border overflow-hidden">
                <!-- Results injected here -->
            </div>
        </div>
    </div>

    <!-- Zone Viewer (Game Window) -->
    <div id="zoneViewer">
        <div class="flex justify-end p-2 bg-deep-black border-b border-brand-border">
            <div id="gameNameZone" class="text-white text-lg font-semibold flex-grow pl-4 py-1 truncate"></div>
            <button id="newTabBtnZone" class="p-2 text-gray-300 hover:text-white transition" title="Open in New Tab">
                <i class="fa-solid fa-up-right-from-square"></i>
            </button>
            <button id="fullscreenBtnZone" class="p-2 text-gray-300 hover:text-white transition" title="Fullscreen">
                <i class="fa-solid fa-expand"></i>
            </button>
            <button id="closeBtnZone" class="p-2 text-red-400 hover:text-red-500 transition" title="Close">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
        <iframe id="zoneFrame" allowfullscreen></iframe>
    </div>

    <!-- JavaScript Game Logic -->
    <script>
        // Define all game categories and their associated colors/icons
        const categories = [
            { name: "Featured", color: "accent-indigo", icon: "fa-star" },
            { name: "StrongDog", color: "strongdog-orange", icon: "fa-dog" },
            { name: "Action", color: "red-500", icon: "fa-gun" },
            { name: "Puzzle", color: "green-500", icon: "fa-puzzle-piece" },
            { name: "Retro", color: "yellow-500", icon: "fa-gamepad" },
            { name: "GN-Math", color: "gn-math", icon: "fa-calculator" },
            { name: "Others", color: "other-grey", icon: "fa-grip-horizontal" } // New category with light grey color
        ];

        // Define all games
        const allGames = [
            // --- Featured/Standard Games (Keeping a few for context) ---
            {
                name: "Fortnite",
                category: "Featured",
                path: "https://fortnite.com/",
                image: "https://placehold.co/300x200/4f46e5/FFFFFF?text=FN",
                description: "The world's most popular battle royale game.",
                tags: ["Shooter", "Survival", "Multiplayer"],
                isFavorite: true,
            },
            {
                name: "Minecraft",
                category: "Featured",
                path: "https://minecraft.net/",
                image: "https://placehold.co/300x200/10b981/FFFFFF?text=MC",
                description: "Block-building and endless creative adventure.",
                tags: ["Survival", "Building", "Sandbox"],
                isFavorite: false,
            },
            {
                name: "Run 3",
                category: "Action",
                path: "https://coolmathgames.com/run3",
                image: "https://placehold.co/300x200/ef4444/FFFFFF?text=Run+3",
                description: "Run, jump, and navigate tunnels in space.",
                tags: ["Platformer", "Endless Runner"],
                isFavorite: false,
            },
            {
                name: "2048",
                category: "Puzzle",
                path: "https://2048game.com/",
                image: "https://placehold.co/300x200/22c55e/FFFFFF?text=2048",
                description: "Slide and combine tiles to reach 2048.",
                tags: ["Logic", "Math"],
                isFavorite: false,
            },
            {
                name: "StrongDog",
                category: "StrongDog",
                path: "https://strongdog.com/",
                image: "https://placehold.co/300x200/FFA500/000000?text=StrongDog",
                description: "A tribute to a beloved dog.",
                tags: ["Tribute", "Arcade"],
                isFavorite: true,
            },
            
            // --- New Games for "Others" Category ---
            // Eaglercraft on top
            {
                name: "Eaglercraft",
                category: "Others",
                path: "/eaglercraft", // Use a relative path placeholder
                image: "./images/eaglercraft.png",
                description: "The classic survival and building game, featuring authentic block-based physics and multiplayer support, all accessible directly in your browser.",
                tags: ["3D", "Multiplayer", "Survival", "Building"],
                isFavorite: false,
            },
            // DOOM next
            {
                name: "DOOM",
                category: "Others",
                path: "/doom", // Use a relative path placeholder
                image: "./images/DOOM.png",
                description: "The legendary first-person shooter that pioneered the genre. Blast through hordes of demons in this timeless, adrenaline-fueled classic.",
                tags: ["FPS", "Action", "Classic", "Retro"],
                isFavorite: false,
            },
        ];

        let currentCategoryIndex = 0;
        const gamesContainer = document.getElementById('gamesContainer');
        const categoryTitle = document.getElementById('categoryTitle');
        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('searchResults');
        const prevCategoryBtn = document.getElementById('prevCategoryBtn');
        const nextCategoryBtn = document.getElementById('nextCategoryBtn');
        const categoryCycleBtn = document.getElementById('categoryCycleBtn');
        const zoneViewer = document.getElementById('zoneViewer');
        const zoneFrame = document.getElementById('zoneFrame');
        const gameNameZone = document.getElementById('gameNameZone');
        
        /**
         * Renders the game cards for the current category.
         */
        function renderGames(categoryName) {
            gamesContainer.innerHTML = '';
            const filteredGames = allGames.filter(game => game.category === categoryName);
            
            // For "Others" category, we render only the games in that category,
            // using the specialized card design. For all other categories, 
            // the standard card design is used.

            filteredGames.forEach(game => {
                 gamesContainer.appendChild(createGameCard(game));
            });
            
            // If no games, display a message
            if (filteredGames.length === 0) {
                gamesContainer.innerHTML = `<p class="col-span-12 text-center text-gray-500 py-10">No games found in this category.</p>`;
            }
        }

        /**
         * Updates the UI to show the selected category.
         */
        function switchCategory(index) {
            currentCategoryIndex = index;
            const category = categories[currentCategoryIndex];
            // Resolve color from Tailwind config or use the direct value
            const colorKey = category.color;
            const resolvedColor = tailwind.config.theme.extend.colors[colorKey] || colorKey;

            categoryTitle.textContent = category.name;
            categoryTitle.style.color = resolvedColor;
            categoryTitle.style.borderColor = resolvedColor;

            renderGames(category.name);
        }

        /**
         * Creates the HTML card element for a game.
         * @param {object} game - The game object.
         * @returns {HTMLElement} The card element.
         */
        function createGameCard(game) {
            const isOthersCard = game.category === "Others";
            const categoryMeta = categories.find(c => c.name === game.category) || {};
            const colorClass = categoryMeta.color || 'accent-indigo';
            // Resolve color from Tailwind config or use the direct value
            const accentColor = tailwind.config.theme.extend.colors[colorClass] || colorClass;

            const card = document.createElement('div');
            // Full width for "Others" cards, responsive width for standard cards
            card.className = `game-card zone-item w-full ${isOthersCard ? 'col-span-12' : 'col-span-12 sm:col-span-6 md:col-span-4 lg:col-span-3 xl:col-span-2'} p-2`;
            card.setAttribute('data-game-path', game.path);
            card.setAttribute('data-game-name', game.name);

            // --- Special "Others" Card Layout (Full Width, Taller) ---
            if (isOthersCard) {
                // IMPORTANT NOTE: The recommended aspect ratio for the image is 16:9
                card.innerHTML = `
                    <div class="bg-card-dark rounded-xl overflow-hidden shadow-2xl border border-brand-border h-[450px] sm:h-[400px] flex flex-col hover:border-accent-indigo transition duration-300">
                        <!-- Image Container (16:9 aspect ratio placeholder) -->
                        <div class="relative w-full h-auto aspect-16/9 overflow-hidden">
                            <img src="${game.image}" alt="${game.name} thumbnail" 
                                class="w-full h-full object-cover transition-transform duration-300 hover:scale-[1.03]" 
                                onerror="this.onerror=null; this.src='https://placehold.co/1600x900/181818/FFFFFF?text=${game.name.replace(/ /g, '+')}&font=Geist'"
                            >
                            
                            <!-- Title Overlay (Top Left) -->
                            <div class="absolute top-4 left-4 p-2 rounded-lg bg-deep-black/70 backdrop-blur-sm border border-white/20">
                                <h3 class="text-3xl font-semibold text-white">${game.name}</h3>
                            </div>
                        </div>

                        <!-- Content and Buttons Area -->
                        <div class="p-6 flex justify-between items-end flex-grow-0 min-h-[120px] h-full">
                            <!-- Description (Bottom Left) -->
                            <div class="flex flex-col justify-end h-full max-w-[70%]">
                                <p class="text-gray-400 text-sm md:text-base">${game.description}</p>
                            </div>

                            <!-- Buttons (Bottom Right) -->
                            <div class="flex space-x-3">
                                <!-- Favorite Button -->
                                <button class="favorite-btn p-3 rounded-full bg-brand-border text-white text-lg hover:bg-white/10 transition duration-150 ${game.isFavorite ? 'favorited' : ''}" data-game-name="${game.name}">
                                    <i class="fa-solid fa-star fa-solid-star"></i>
                                    <i class="fa-regular fa-star fa-regular-star"></i>
                                </button>
                                
                                <!-- Play Button -->
                                <button class="play-btn p-3 rounded-full bg-accent-indigo text-white text-lg hover:bg-indigo-600 transition duration-150 shadow-lg shadow-accent-indigo/30" onclick="openGameInZone(this.closest('.game-card'))">
                                    <i class="fa-solid fa-play fa-solid-play"></i>
                                    <i class="fa-regular fa-play fa-regular-play"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            } 
            // --- Standard Card Layout (Existing logic) ---
            else {
                card.innerHTML = `
                    <div class="bg-card-dark rounded-xl p-4 overflow-hidden shadow-lg border border-brand-border h-full flex flex-col justify-between">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 rounded-full" style="background-color: ${accentColor}"></div>
                                <p class="text-xs font-semibold uppercase text-gray-400" style="color: ${accentColor};">${game.category}</p>
                            </div>
                            <button class="favorite-btn text-gray-500 hover:text-white transition duration-150 ${game.isFavorite ? 'favorited' : ''}" data-game-name="${game.name}">
                                <i class="fa-solid fa-star fa-solid-star text-yellow-400"></i>
                                <i class="fa-regular fa-star fa-regular-star"></i>
                            </button>
                        </div>
                        
                        <div class="flex-grow flex items-center justify-center mb-3">
                            <img src="${game.image}" alt="${game.name} thumbnail" class="w-full aspect-3/2 object-cover rounded-md transition-transform duration-300 hover:scale-[1.05] shadow-lg" 
                                 onerror="this.onerror=null; this.src='https://placehold.co/300x200/181818/FFFFFF?text=${game.name.replace(/ /g, '+')}&font=Geist'"
                            >
                        </div>
                        
                        <h3 class="text-lg font-semibold text-white truncate mb-1">${game.name}</h3>
                        <p class="text-sm text-gray-400 mb-4 h-10 overflow-hidden">${game.description}</p>

                        <div class="flex justify-between items-center">
                            <div class="flex space-x-1 text-xs text-gray-500">
                                ${game.tags.slice(0, 2).map(tag => `<span class="bg-brand-border/50 px-2 py-0.5 rounded">${tag}</span>`).join('')}
                            </div>
                            
                            <button class="play-btn p-2 rounded-full bg-accent-indigo text-white text-md hover:bg-indigo-600 transition duration-150" onclick="openGameInZone(this.closest('.game-card'))">
                                <i class="fa-solid fa-play fa-solid-play"></i>
                                <i class="fa-regular fa-play fa-regular-play"></i>
                            </button>
                        </div>
                    </div>
                `;
            }
            
            return card;
        }

        /**
         * Opens the selected game in the zone viewer iframe.
         */
        function openGameInZone(cardElement) {
            const path = cardElement.getAttribute('data-game-path');
            const name = cardElement.getAttribute('data-game-name');
            
            zoneFrame.src = path;
            gameNameZone.textContent = name;
            zoneViewer.style.display = 'flex';
        }

        /**
         * Closes the zone viewer and resets the iframe.
         */
        function closeZoneViewer() {
            zoneViewer.style.display = 'none';
            zoneFrame.src = 'about:blank'; // Stop any running content
            gameNameZone.textContent = '';
        }

        /**
         * Handles opening the current game in a new tab.
         */
        function openGameInNewTab() {
             const path = zoneFrame.src;
             if (path && path !== 'about:blank') {
                 window.open(path, '_blank');
             }
        }

        /**
         * Handles search input and displays results.
         */
        function handleSearch(event) {
            const query = event.target.value.toLowerCase().trim();
            searchResults.innerHTML = '';

            if (query.length < 2) {
                searchResults.style.display = 'none';
                return;
            }

            const matchedGames = allGames
                .filter(game => 
                    game.name.toLowerCase().includes(query) || 
                    game.description.toLowerCase().includes(query) ||
                    game.tags.some(tag => tag.toLowerCase().includes(query))
                )
                // Limit results to 5 for cleanliness
                .slice(0, 5); 

            if (matchedGames.length > 0) {
                matchedGames.forEach(game => {
                    const resultLink = document.createElement('a');
                    resultLink.href = "#"; // Prevent navigation
                    resultLink.className = 'text-white block hover:bg-brand-border cursor-pointer';
                    resultLink.innerHTML = `
                        <span>${game.name}</span>
                        <span class="text-xs text-gray-500">${game.category}</span>
                    `;
                    // Use a click listener instead of relying on href
                    resultLink.addEventListener('click', (e) => {
                        e.preventDefault();
                        // Close search results and open the game
                        searchResults.style.display = 'none';
                        const tempCard = document.createElement('div');
                        tempCard.setAttribute('data-game-path', game.path);
                        tempCard.setAttribute('data-game-name', game.name);
                        openGameInZone(tempCard);
                        searchInput.value = ''; // Clear search input
                    });
                    searchResults.appendChild(resultLink);
                });
                searchResults.style.display = 'block';
            } else {
                searchResults.style.display = 'block';
                searchResults.innerHTML = `<div class="p-3 text-gray-500 text-center">No results found for "${query}".</div>`;
            }
        }

        /**
         * Handles toggling the favorite state.
         */
        function handleFavoriteToggle(event) {
            const button = event.currentTarget;
            const gameName = button.getAttribute('data-game-name');
            const game = allGames.find(g => g.name === gameName);

            if (game) {
                game.isFavorite = !game.isFavorite;
                button.classList.toggle('favorited', game.isFavorite);
                // Simple state persistence (can be expanded with localStorage/Firebase)
                // Rerender or update card state if necessary (simple toggle is enough here)
            }
        }

        /**
         * Initializes the application and event listeners.
         */
        function initializeApp() {
            // Initial render
            switchCategory(0);

            // Attach favorite event listeners using delegation
            gamesContainer.addEventListener('click', (ev) => {
                if (ev.target.closest('.favorite-btn')) {
                    handleFavoriteToggle({ currentTarget: ev.target.closest('.favorite-btn') });
                }
            });

            // Search listeners
            searchInput.addEventListener("input", handleSearch);
            searchInput.addEventListener("focus", handleSearch);
            
            // --- Category Cycling Event Listeners ---
            const cycle = (direction) => {
                 let newIndex = currentCategoryIndex + direction;
                 if (newIndex < 0) newIndex = categories.length - 1;
                 if (newIndex >= categories.length) newIndex = 0;
                 switchCategory(newIndex);
            };

            prevCategoryBtn.addEventListener('click', () => cycle(-1));
            nextCategoryBtn.addEventListener('click', () => cycle(1));
            categoryCycleBtn.addEventListener('click', () => cycle(1));

            // Hide search results when clicking outside the search area
            document.addEventListener("click", ev => {
                if (!document.getElementById('bottom-fixed-bar').contains(ev.target)) {
                    searchResults.style.display = "none";
                }
            });

            // Zone Viewer Controls
            document.getElementById('fullscreenBtnZone')?.addEventListener('click', () => {
                const zoneFrame = document.getElementById('zoneFrame');
                if (zoneFrame?.requestFullscreen) zoneFrame.requestFullscreen();
            });
            document.getElementById('newTabBtnZone')?.addEventListener('click', openGameInNewTab);
            document.getElementById('closeBtnZone')?.addEventListener('click', closeZoneViewer);
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>

